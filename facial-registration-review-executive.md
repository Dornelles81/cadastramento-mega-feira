# Guia Executivo de Revis√£o - Sistema de Cadastro Facial

## üöÄ QUICK START - Revis√£o em 15 Minutos

### Comando √önico de Valida√ß√£o Completa
```bash
#!/bin/bash
# validate-all.sh - Execute isto antes de qualquer merge

npx concurrently \
  "npm run lint" \
  "npm run type-check" \
  "npm audit --audit-level=high" \
  "npm test -- --coverage" \
  "npm run test:mobile" \
  "npm run test:lgpd" \
  "npm run test:hikcenter" \
  && echo "‚úÖ C√ìDIGO APROVADO" \
  || echo "‚ùå CORRE√á√ïES NECESS√ÅRIAS"
```

---

## ‚úÖ CHECKLIST MASTER - 20 PONTOS CR√çTICOS

### üì± Mobile (5 pontos)
```yaml
‚ñ° 1. playsinline no <video>? 
‚ñ° 2. HTTPS configurado?
‚ñ° 3. Testado iPhone real?
‚ñ° 4. Testado Android real?
‚ñ° 5. Performance < 3s?
```

### üîí Seguran√ßa (5 pontos)
```yaml
‚ñ° 6. Dados criptografados (AES-256)?
‚ñ° 7. npm audit sem HIGH/CRITICAL?
‚ñ° 8. Sem console.log em produ√ß√£o?
‚ñ° 9. Sem secrets no c√≥digo?
‚ñ° 10. Rate limiting ativo?
```

### üìã LGPD (5 pontos)
```yaml
‚ñ° 11. Consentimento registrado?
‚ñ° 12. Exclus√£o ap√≥s 90 dias configurada?
‚ñ° 13. Logs de auditoria ativos?
‚ñ° 14. Direitos do titular implementados?
‚ñ° 15. Dados podem ser exportados?
```

### üîå Integra√ß√£o (5 pontos)
```yaml
‚ñ° 16. HikCenter batch ‚â§ 100?
‚ñ° 17. Retry implementado?
‚ñ° 18. CPF validado?
‚ñ° 19. Queue Redis funcionando?
‚ñ° 20. Webhook handler pronto?
```

---

## üõ†Ô∏è FERRAMENTAS DE REVIS√ÉO AUTOM√ÅTICA

### 1. Setup Inicial (5 minutos)
```bash
# install-review-tools.sh
npm install -D \
  eslint \
  @typescript-eslint/eslint-plugin \
  eslint-plugin-security \
  eslint-plugin-react-hooks \
  husky \
  lint-staged \
  jest \
  @testing-library/react \
  @testing-library/jest-dom \
  playwright \
  lighthouse \
  bundlesize

# Configurar Husky
npx husky install
npx husky add .husky/pre-commit "npm run pre-commit"
npx husky add .husky/pre-push "npm run pre-push"
```

### 2. Scripts NPM Essenciais
```json
// package.json
{
  "scripts": {
    "lint": "eslint src/ --ext .ts,.tsx --max-warnings 0",
    "type-check": "tsc --noEmit",
    "test": "jest --coverage",
    "test:mobile": "playwright test --project=mobile",
    "test:lgpd": "jest tests/lgpd --testNamePattern=LGPD",
    "test:hikcenter": "jest tests/integration/hikcenter",
    "security": "npm audit --audit-level=high && npx snyk test",
    "bundle-size": "bundlesize",
    "pre-commit": "lint-staged",
    "pre-push": "npm run test && npm run security",
    "validate": "npm run lint && npm run type-check && npm run test",
    "review": "node scripts/code-review.js"
  },
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --fix", "prettier --write"],
    "*.test.{ts,tsx}": ["jest --bail --findRelatedTests"]
  },
  "bundlesize": [
    {
      "path": "./dist/js/*.js",
      "maxSize": "500 kB"
    }
  ]
}
```

### 3. Configura√ß√£o ESLint Rigorosa
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'plugin:security/recommended'
  ],
  rules: {
    // Bloqueadores
    'no-console': 'error',
    'no-debugger': 'error',
    'no-alert': 'error',
    'no-eval': 'error',
    '@typescript-eslint/no-any': 'error',
    '@typescript-eslint/no-explicit-any': 'error',
    
    // Seguran√ßa
    'security/detect-object-injection': 'error',
    'security/detect-non-literal-regexp': 'warn',
    'security/detect-unsafe-regex': 'error',
    
    // React
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'error',
    
    // Qualidade
    'complexity': ['error', 10],
    'max-lines': ['error', 300],
    'max-depth': ['error', 4]
  }
};
```

---

## üîç REVIS√ÉO MANUAL - PONTOS DE ATEN√á√ÉO

### C√≥digo Suspeito - Red Flags üö©
```javascript
// ‚ùå EVITAR
localStorage.setItem('cpf', cpf); // Dados sens√≠veis em storage
eval(userInput); // Eval com input do usu√°rio
http://api.com // HTTP ao inv√©s de HTTPS
SELECT * FROM users WHERE cpf = '${cpf}' // SQL injection
innerHTML = userContent // XSS vulnerability
catch(e) {} // Silenciar erros
setInterval(() => {}, 100) // Polling agressivo
new Date().getTime() // Usar Date.now()

// ‚úÖ CORRETO
sessionStorage.setItem('sessionId', token);
JSON.parse(sanitizedInput);
https://api.com
prisma.users.findUnique({ where: { cpf } })
textContent = userContent
catch(e) { logger.error(e); }
addEventListener('change', handler)
Date.now()
```

### Padr√µes iOS Safari Obrigat√≥rios
```html
<!-- ‚úÖ CORRETO para iOS -->
<video 
  playsinline 
  webkit-playsinline 
  muted
  autoplay={false}
  style="pointer-events: none;"
/>

<script>
// ‚úÖ Detectar iOS
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

// ‚úÖ Configurar constraints espec√≠ficos
const constraints = {
  video: {
    facingMode: 'user',
    width: { ideal: 1280 },
    height: { ideal: 720 },
    ...(isIOS && { 
      width: { max: 1280 }, 
      height: { max: 720 }
    })
  }
};
</script>
```

---

## üìä M√âTRICAS DE QUALIDADE

### Metas Obrigat√≥rias
```yaml
Cobertura de Testes:
  Total: ‚â• 80%
  Branches: ‚â• 75%
  Functions: ‚â• 85%
  Lines: ‚â• 80%

Performance:
  First Contentful Paint: < 1.5s
  Time to Interactive: < 3.5s
  Bundle Size: < 500KB
  API Response P95: < 3s

Seguran√ßa:
  Vulnerabilities HIGH: 0
  Vulnerabilities CRITICAL: 0
  Security Headers Score: A+
  SSL Labs Score: A+

C√≥digo:
  Complexidade Ciclom√°tica: < 10
  Duplica√ß√£o: < 3%
  Code Smells: < 5
  Technical Debt: < 2 dias
```

---

## üö® SCRIPT DE BLOQUEIO AUTOM√ÅTICO

```javascript
// scripts/auto-block.js
const fs = require('fs');
const { execSync } = require('child_process');

class CodeBlocker {
  constructor() {
    this.failures = [];
  }

  check(test, message) {
    try {
      const result = execSync(test, { encoding: 'utf8' });
      console.log(`‚úÖ ${message}`);
      return true;
    } catch (error) {
      console.error(`‚ùå ${message}`);
      this.failures.push(message);
      return false;
    }
  }

  run() {
    console.log('üîç Iniciando valida√ß√£o de bloqueio...\n');

    // Cr√≠ticos - Bloqueiam imediatamente
    this.check('grep -r "console.log" src/', 'Sem console.logs');
    this.check('npm audit --audit-level=high --json | grep "found 0"', 'Sem vulnerabilidades');
    this.check('grep -r "localStorage" src/ | grep -v "test"', 'Sem localStorage com dados sens√≠veis');
    this.check('grep -r "http://" src/', 'Apenas HTTPS');
    this.check('grep -r "eval(" src/', 'Sem eval()');
    
    // Mobile
    this.check('grep -r "playsinline" src/components/FaceCapture', 'iOS playsinline presente');
    
    // LGPD
    this.check('grep -r "consent" src/services/', 'Gest√£o de consentimento presente');
    this.check('grep -r "encrypt" src/utils/', 'Criptografia implementada');
    
    // Testes
    this.check('npm test -- --coverage --silent 2>&1 | grep "All tests passed"', 'Testes passando');

    // Resultado
    if (this.failures.length > 0) {
      console.log('\n‚ùå C√ìDIGO BLOQUEADO - Corre√ß√µes necess√°rias:');
      this.failures.forEach(f => console.log(`  - ${f}`));
      process.exit(1);
    } else {
      console.log('\n‚úÖ C√ìDIGO APROVADO PARA MERGE');
      process.exit(0);
    }
  }
}

new CodeBlocker().run();
```

---

## üì± TESTE MOBILE R√ÅPIDO

```bash
#!/bin/bash
# quick-mobile-test.sh

# 1. Build
npm run build

# 2. Criar certificado tempor√°rio
openssl req -x509 -nodes -days 1 -newkey rsa:2048 \
  -keyout /tmp/server.key \
  -out /tmp/server.crt \
  -subj "/CN=localhost"

# 3. Servir com HTTPS
npx http-server dist \
  --ssl \
  --cert /tmp/server.crt \
  --key /tmp/server.key \
  --port 8443 &

# 4. Obter IP e gerar QR Code
IP=$(hostname -I | awk '{print $1}')
echo "Teste em: https://$IP:8443"
qrencode -t UTF8 "https://$IP:8443"

# 5. Abrir automaticamente no Chrome e Safari se dispon√≠vel
if command -v google-chrome &> /dev/null; then
    google-chrome --auto-open-devtools-for-tabs "https://localhost:8443" &
fi

if command -v open &> /dev/null; then
    open -a Safari "https://localhost:8443" &
fi

echo "Pressione ENTER ap√≥s testar no celular..."
read

# 6. Limpar
pkill -f http-server
rm /tmp/server.{key,crt}
```

---

## üéØ PLANO DE A√á√ÉO DI√ÅRIO

### Segunda - Revis√£o de Seguran√ßa
```bash
npm audit fix
npx snyk test
grep -r "TODO\|FIXME\|XXX\|HACK" src/
./scripts/security-scan.sh
```

### Ter√ßa - Revis√£o de Performance
```bash
npm run build -- --analyze
lighthouse https://localhost:3000
npm run test:load
```

### Quarta - Revis√£o Mobile
```bash
npm run test:mobile:ios
npm run test:mobile:android
./scripts/cross-browser-test.sh
```

### Quinta - Revis√£o LGPD
```bash
npm run test:lgpd
./scripts/data-retention-check.sh
./scripts/consent-flow-test.sh
```

### Sexta - Revis√£o Integra√ß√£o
```bash
npm run test:hikcenter
npm run test:integration
./scripts/end-to-end-test.sh
```

---

## üìà DASHBOARD DE REVIS√ÉO

```html
<!-- review-dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Dashboard de Revis√£o</title>
    <style>
        .metric { 
            display: inline-block; 
            margin: 10px; 
            padding: 20px; 
            border: 1px solid #ccc; 
        }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        .warn { background: #fff3cd; }
    </style>
</head>
<body>
    <h1>Status de Revis√£o - Sistema Cadastro Facial</h1>
    
    <div id="metrics"></div>
    
    <script>
        async function checkStatus() {
            const checks = [
                { name: 'Build', cmd: 'npm run build' },
                { name: 'Testes', cmd: 'npm test' },
                { name: 'Seguran√ßa', cmd: 'npm audit' },
                { name: 'TypeScript', cmd: 'tsc --noEmit' },
                { name: 'Mobile iOS', cmd: './test-ios.sh' },
                { name: 'LGPD', cmd: './lgpd-check.sh' },
                { name: 'HikCenter', cmd: './hikcenter-test.sh' }
            ];
            
            const results = await Promise.all(
                checks.map(async (check) => {
                    try {
                        const response = await fetch(`/api/check/${check.cmd}`);
                        return { ...check, status: response.ok ? 'pass' : 'fail' };
                    } catch (e) {
                        return { ...check, status: 'warn' };
                    }
                })
            );
            
            const html = results.map(r => `
                <div class="metric ${r.status}">
                    <h3>${r.name}</h3>
                    <p>${r.status.toUpperCase()}</p>
                </div>
            `).join('');
            
            document.getElementById('metrics').innerHTML = html;
        }
        
        checkStatus();
        setInterval(checkStatus, 30000); // Atualizar a cada 30s
    </script>
</body>
</html>
```

---

## üöÄ COMANDO FINAL DE VALIDA√á√ÉO

```bash
#!/bin/bash
# ultimate-validation.sh

echo "======================================"
echo "   VALIDA√á√ÉO COMPLETA DO SISTEMA     "
echo "======================================"

# Executar todas as valida√ß√µes em paralelo
npx concurrently --kill-others-on-fail \
  --names "LINT,TYPE,SEC,TEST,MOB,LGPD,HIK,PERF" \
  --prefix-colors "yellow,blue,red,green,magenta,cyan,white,gray" \
  "npm run lint" \
  "npm run type-check" \
  "npm run security" \
  "npm run test:coverage" \
  "npm run test:mobile" \
  "npm run test:lgpd" \
  "npm run test:hikcenter" \
  "npm run test:performance"

if [ $? -eq 0 ]; then
  echo ""
  echo "‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ"
  echo "   SISTEMA 100% VALIDADO!"
  echo "   Pronto para produ√ß√£o"
  echo "‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ"
  
  # Gerar relat√≥rio
  node scripts/generate-validation-report.js
  
  # Criar tag git
  git tag -a "validated-$(date +%Y%m%d-%H%M%S)" -m "C√≥digo validado e aprovado"
  
  exit 0
else
  echo ""
  echo "‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå"
  echo "   FALHA NA VALIDA√á√ÉO!"
  echo "   Corrija os problemas acima"
  echo "‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå"
  exit 1
fi
```

---

## üìã CONCLUS√ÉO

Com este guia executivo voc√™ tem:

1. **Checklist de 20 pontos** para revis√£o r√°pida
2. **Scripts prontos** para valida√ß√£o autom√°tica
3. **Ferramentas configuradas** em 5 minutos
4. **M√©tricas claras** de qualidade
5. **Processo di√°rio** estruturado
6. **Dashboard visual** de status
7. **Comando √∫nico** de valida√ß√£o completa

**GARANTIA: Nenhum c√≥digo com falha passar√° por este processo!**